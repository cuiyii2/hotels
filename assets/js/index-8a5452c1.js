import{l as ye,R as I,T as be,h as S,d as z,U as F,r as B,o as g,c as V,V as se,w,a as N,t as we,j as x,J,F as O,e as j,g as R,W as H,u as b,X as U,Y as G,Z as Se,z as ue,_ as Ce,$ as ke,a0 as Pe,a1 as q,a2 as pe,a3 as Y,a4 as ce,a5 as $e,i as de,v as ie,f as C,b as oe,D as he,I as fe,a6 as Ve,a7 as re,a8 as ae,a9 as ze,aa as Ie,ab as Ne}from"./main-5a92e9dd.js";import{_ as le}from"./mplugin-vue_export-helper-c27b6911.js";const me=""+new URL("../png/notData-4f65e242.png",import.meta.url).href,Be=(f,p={},l=!0,m)=>{const t=ye({tableData:[],pageable:{pageNum:1,pageSize:10,total:0},searchParam:{},searchInitParam:{},totalParam:{}}),i=I({get:()=>({pageNum:t.pageable.pageNum,pageSize:t.pageable.pageSize}),set:c=>{}}),a=async()=>{try{Object.assign(t.totalParam,p,l?i.value:{});let{data:c}=await f({...t.searchInitParam,...t.totalParam});m&&(c=m(c)),t.tableData=l?c.list:c;const{pageNum:_,pageSize:T,total:A}=c;l&&e({pageNum:_,pageSize:T,total:A})}catch{}},r=()=>{t.totalParam={};let c={};for(let _ in t.searchParam)(t.searchParam[_]||t.searchParam[_]===!1||t.searchParam[_]===0)&&(c[_]=t.searchParam[_]);Object.assign(t.totalParam,c,l?i.value:{})},e=c=>{Object.assign(t.pageable,c)},o=()=>{t.pageable.pageNum=1,r(),a()},s=()=>{t.pageable.pageNum=1,t.searchParam={},Object.keys(t.searchInitParam).forEach(c=>{t.searchParam[c]=t.searchInitParam[c]}),r(),a()},d=c=>{t.pageable.pageNum=1,t.pageable.pageSize=c,a()},u=c=>{t.pageable.pageNum=c,a()};return{...be(t),getTableList:a,search:o,reset:s,handleSizeChange:d,handleCurrentChange:u,updatedTotalParam:r}},Ee=(f="id")=>{const p=S(!1),l=S([]),m=I(()=>{let i=[];return l.value.forEach(a=>i.push(a[f])),i});return{isSelected:p,selectedList:l,selectedListIds:m,selectionChange:i=>{i.length===0?p.value=!1:p.value=!0,l.value=i}}},Me=z({name:"SearchFormItem"}),Re=z({...Me,props:{column:{},searchParam:{}},setup(f){const p=f,l=I(()=>{var e,o;return{label:((e=p.column.fieldNames)==null?void 0:e.label)??"label",value:((o=p.column.fieldNames)==null?void 0:o.value)??"value"}}),m=F("enumMap",S(new Map)),t=I(()=>{var o;let e=m.value.get(p.column.prop);return e?(((o=p.column.search)==null?void 0:o.el)==="select-v2"&&p.column.fieldNames&&(e=e.map(s=>({...s,label:s[l.value.label],value:s[l.value.value]}))),e):[]}),i=I(()=>{var c,_;const e=l.value.label,o=l.value.value,s=(c=p.column.search)==null?void 0:c.el,d=((_=p.column.search)==null?void 0:_.props)??{};let u=d;return s==="tree-select"&&(u={...d,props:{label:e,...d.props},nodeKey:o}),s==="cascader"&&(u={...d,props:{label:e,value:o,...d.props}}),u}),a=I(()=>{var o;const e=p.column.search;return((o=e==null?void 0:e.props)==null?void 0:o.placeholder)??((e==null?void 0:e.el)==="input"?"请输入":"全部")}),r=I(()=>{var o;const e=p.column.search;return((o=e==null?void 0:e.props)==null?void 0:o.clearable)??((e==null?void 0:e.defaultValue)==null||(e==null?void 0:e.defaultValue)==null)});return(e,o)=>{var d,u,c,_,T,A;const s=B("el-date-picker");return(d=e.column.search)!=null&&d.el&&((u=e.column.search)==null?void 0:u.el)!="date-picker"?(g(),V(G(`el-${e.column.search.el}`),H({key:0},i.value,{modelValue:e.searchParam[e.column.search.key??b(U)(e.column.prop)],"onUpdate:modelValue":o[0]||(o[0]=$=>e.searchParam[e.column.search.key??b(U)(e.column.prop)]=$),modelModifiers:{trim:!0},data:((c=e.column.search)==null?void 0:c.el)==="tree-select"?t.value:[],options:["cascader","select-v2"].includes((_=e.column.search)==null?void 0:_.el)?t.value:[],placeholder:a.value,clearable:r.value,"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间"}),se({default:w(()=>[e.column.search.el==="select"?(g(!0),x(O,{key:0},J(t.value,($,k)=>(g(),V(G("el-option"),{key:k,label:$[l.value.label],value:$[l.value.value]},null,8,["label","value"]))),128)):j("",!0),e.column.search.el==="radio-group"?(g(!0),x(O,{key:1},J(t.value,($,k)=>(g(),V(G("el-radio"),{key:k,label:$[l.value.label],value:$[l.value.value]},null,8,["label","value"]))),128)):R(e.$slots,"default",{key:2},void 0,!0)]),_:2},[e.column.search.el==="cascader"?{name:"default",fn:w(({data:$})=>[N("span",null,we($[l.value.label]),1)]),key:"0"}:void 0]),1040,["modelValue","data","options","placeholder","clearable"])):(g(),V(s,{key:1,modelValue:e.searchParam[e.column.search.key??b(U)(e.column.prop)],"onUpdate:modelValue":o[1]||(o[1]=$=>e.searchParam[e.column.search.key??b(U)(e.column.prop)]=$),modelModifiers:{trim:!0},type:(A=(T=e.column.search)==null?void 0:T.props)==null?void 0:A.type,"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间"},null,8,["modelValue","type"]))}}});const Te=le(Re,[["__scopeId","data-v-27b01f68"]]),Le=z({name:"Grid"}),Ae=z({...Le,props:{cols:{default:()=>({xs:1,sm:2,md:2,lg:3,xl:4})},collapsed:{type:Boolean,default:!1},collapsedRows:{default:1},gap:{default:0}},setup(f,{expose:p}){const l=f;Se(()=>l.collapsed&&e()),ue(()=>{m({target:{innerWidth:window.innerWidth}}),window.addEventListener("resize",m)}),Ce(()=>{m({target:{innerWidth:window.innerWidth}}),window.addEventListener("resize",m)}),ke(()=>{window.removeEventListener("resize",m)}),Pe(()=>{window.removeEventListener("resize",m)});const m=d=>{let u=d.target.innerWidth;switch(!!u){case u<768:t.value="xs";break;case(u>=768&&u<992):t.value="sm";break;case(u>=992&&u<1200):t.value="md";break;case(u>=1200&&u<1920):t.value="lg";break;case u>=1920:t.value="xl";break}};q("gap",Array.isArray(l.gap)?l.gap[0]:l.gap);let t=S("xl");q("breakPoint",t);const i=S(-1);q("shouldHiddenIndex",i);const a=I(()=>typeof l.cols=="object"?l.cols[t.value]??l.cols:l.cols);q("cols",a);const r=pe().default(),e=()=>{var _,T,A,$;let d=[],u=null;r.forEach(k=>{var L;typeof k.type=="object"&&k.type.name==="GridItem"&&((L=k.props)==null?void 0:L.suffix)!==void 0&&(u=k),typeof k.type=="symbol"&&Array.isArray(k.children)&&k.children.forEach(E=>d.push(E))});let c=0;u&&(c=(((_=u.props[t.value])==null?void 0:_.span)??((T=u.props)==null?void 0:T.span)??1)+(((A=u.props[t.value])==null?void 0:A.offset)??(($=u.props)==null?void 0:$.offset)??0));try{let k=!1;d.reduce((L=0,E,Z)=>{var W,K,D,X;if(L+=(((W=E.props[t.value])==null?void 0:W.span)??((K=E.props)==null?void 0:K.span)??1)+(((D=E.props[t.value])==null?void 0:D.offset)??((X=E.props)==null?void 0:X.offset)??0),L>l.collapsedRows*a.value-c)throw i.value=Z,k=!0,"find it";return L},0),k||(i.value=-1)}catch{}};Y(()=>t.value,()=>{l.collapsed&&e()}),Y(()=>l.collapsed,d=>{if(d)return e();i.value=-1});const o=I(()=>typeof l.gap=="number"?`${l.gap}px`:Array.isArray(l.gap)?`${l.gap[1]}px ${l.gap[0]}px`:"unset"),s=I(()=>({display:"grid",gridGap:o.value,gridTemplateColumns:`repeat(${a.value}, minmax(0, 1fr))`}));return p({breakPoint:t}),(d,u)=>(g(),x("div",{style:ce(s.value)},[R(d.$slots,"default")],4))}}),je=z({name:"GridItem"}),ne=z({...je,props:{offset:{default:0},span:{default:1},suffix:{type:Boolean,default:!1},xs:{default:void 0},sm:{default:void 0},md:{default:void 0},lg:{default:void 0},xl:{default:void 0}},setup(f){const p=f,l=$e(),m=S(!0),t=F("breakPoint",S("xl")),i=F("shouldHiddenIndex",S(-1));Y(()=>[i.value,t.value],o=>{l.index&&(m.value=!(o[0]!==-1&&parseInt(l.index)>=o[0]))},{immediate:!0});const a=F("gap",0),r=F("cols",S(4)),e=I(()=>{var d,u;let o=((d=p[t.value])==null?void 0:d.span)??p.span,s=((u=p[t.value])==null?void 0:u.offset)??p.offset;return p.suffix?{gridColumnStart:r.value-o-s+1,gridColumnEnd:`span ${o+s}`,marginLeft:s!==0?`calc(((100% + ${a}px) / ${o+s}) * ${s})`:"unset"}:{gridColumn:`span ${o+s>r.value?r.value:o+s}/span ${o+s>r.value?r.value:o+s}`,marginLeft:s!==0?`calc(((100% + ${a}px) / ${o+s}) * ${s})`:"unset"}});return(o,s)=>de((g(),x("div",{style:ce(e.value)},[R(o.$slots,"default")],4)),[[ie,m.value]])}}),xe={key:0,class:"card table-search"},De={class:"operation"},Oe=z({name:"SearchForm"}),Fe=z({...Oe,props:{columns:{default:()=>[]},searchParam:{default:()=>({})},searchCol:{},search:{},reset:{}},setup(f){const p=f,l=r=>{var e,o,s,d,u,c,_;return{span:(e=r.search)==null?void 0:e.span,offset:((o=r.search)==null?void 0:o.offset)??0,xs:(s=r.search)==null?void 0:s.xs,sm:(d=r.search)==null?void 0:d.sm,md:(u=r.search)==null?void 0:u.md,lg:(c=r.search)==null?void 0:c.lg,xl:(_=r.search)==null?void 0:_.xl}},m=S(!1),t=S(),i=I(()=>{var r;return(r=t.value)==null?void 0:r.breakPoint}),a=I(()=>{let r=!1;return p.columns.reduce((e,o)=>{var s,d,u,c;return e+=(((s=o.search[i.value])==null?void 0:s.span)??((d=o.search)==null?void 0:d.span)??1)+(((u=o.search[i.value])==null?void 0:u.offset)??((c=o.search)==null?void 0:c.offset)??0),typeof p.searchCol!="number"?e>=p.searchCol[i.value]&&(r=!0):e>=p.searchCol&&(r=!0),e},0),r});return(r,e)=>{const o=B("el-form-item"),s=B("el-button"),d=B("el-form");return r.columns.length?(g(),x("div",xe,[C(d,{ref:"formRef",model:r.searchParam},{default:w(()=>[C(Ae,{ref_key:"gridRef",ref:t,collapsed:m.value,gap:[20,0],cols:r.searchCol},{default:w(()=>[(g(!0),x(O,null,J(r.columns,(u,c)=>(g(),V(ne,H({key:u.prop},l(u),{index:c}),{default:w(()=>[C(o,{label:`${u.label}`,"label-width":u.labelWidth},{default:w(()=>[C(Te,{column:u,searchParam:r.searchParam},null,8,["column","searchParam"])]),_:2},1032,["label","label-width"])]),_:2},1040,["index"]))),128)),C(ne,{suffix:""},{default:w(()=>[N("div",De,[a.value?(g(),V(s,{key:0,type:"primary",link:"",class:"search-isOpen",onClick:e[0]||(e[0]=u=>m.value=!m.value)})):j("",!0),C(s,{onClick:r.reset},{default:w(()=>[oe("重置")]),_:1},8,["onClick"]),C(s,{type:"primary",onClick:r.search},{default:w(()=>[oe("查询")]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["collapsed","cols"])]),_:1},8,["model"])])):j("",!0)}}}),Ue=z({name:"Pagination"}),He=z({...Ue,props:{pageable:{},handleSizeChange:{type:Function},handleCurrentChange:{type:Function}},setup(f){return(p,l)=>{const m=B("el-pagination");return g(),V(m,{"current-page":p.pageable.pageNum,"page-size":p.pageable.pageSize,"page-sizes":[10,25,50,100],background:!0,layout:"sizes, prev, pager, next, jumper",total:p.pageable.total,onSizeChange:p.handleSizeChange,onCurrentChange:p.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])}}}),We=f=>(he("data-v-a152b301"),f=f(),fe(),f),Ke={class:"table-main"},qe=We(()=>N("div",{class:"table-empty"},[N("img",{src:me,alt:"notData"}),N("div",null,"暂无可配置列")],-1)),Ge=z({name:"ColSetting"}),Je=z({...Ge,props:{colSetting:{}},setup(f,{expose:p}){const l=S(!1);return p({openColSetting:()=>{l.value=!0}}),(t,i)=>{const a=B("el-table-column"),r=B("el-switch"),e=B("el-table"),o=B("el-drawer");return g(),V(o,{title:"列设置",modelValue:l.value,"onUpdate:modelValue":i[0]||(i[0]=s=>l.value=s),size:"450px"},{default:w(()=>[N("div",Ke,[C(e,{data:t.colSetting,border:!0,"row-key":"prop","default-expand-all":"","tree-props":{children:"_children"}},{empty:w(()=>[qe]),default:w(()=>[C(a,{prop:"label",align:"center",label:"列名"}),C(a,{prop:"isShow",align:"center",label:"显示"},{default:w(s=>[C(r,{modelValue:s.row.isShow,"onUpdate:modelValue":d=>s.row.isShow=d},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),C(a,{prop:"sortable",align:"center",label:"排序"},{default:w(s=>[C(r,{modelValue:s.row.sortable,"onUpdate:modelValue":d=>s.row.sortable=d},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"])])]),_:1},8,["modelValue"])}}});const Xe=le(Je,[["__scopeId","data-v-a152b301"]]);function Ye(f){return typeof f=="function"||Object.prototype.toString.call(f)==="[object Object]"&&!Ve(f)}const Ze=z({name:"TableColumn"}),Qe=z({...Ze,props:{column:{}},setup(f){const p=pe(),l=F("enumMap",S(new Map)),m=(a,r)=>l.value.get(a.prop)&&a.isFilterEnum?re(ae(r.row,a.prop),l.value.get(a.prop),a.fieldNames):ze(ae(r.row,a.prop)),t=(a,r)=>re(ae(r.row,a.prop),l.value.get(a.prop),a.fieldNames,"tag"),i=a=>C(O,null,[a.isShow&&C(B("el-table-column"),H(a,{align:a.align??"left",showOverflowTooltip:a.showOverflowTooltip??a.prop!=="operation"}),{default:r=>{let e;return a._children?a._children.map(o=>i(o)):a.render?a.render(r):p[a.prop]?p[a.prop](r):a.tag?C(B("el-tag"),{type:t(a,r)},Ye(e=m(a,r))?e:{default:()=>[e]}):m(a,r)},header:()=>a.headerRender?a.headerRender(a):p[`${a.prop}Header`]?p[`${a.prop}Header`]({row:a}):a.label})]);return(a,r)=>(g(),V(G(i(a.column))))}}),te=f=>(he("data-v-5390eecb"),f=f(),fe(),f),ea={class:"card table-main"},aa={class:"table-title"},la={class:"table-header"},ta=te(()=>N("div",{class:"header-button-lf"},null,-1)),oa={class:"header-button-ri"},ra={class:"table-empty"},na=te(()=>N("img",{src:me,alt:"notData"},null,-1)),sa=te(()=>N("div",null,"暂无数据",-1)),ua=z({name:"ProTable"}),pa=z({...ua,props:{columns:{default:()=>[]},requestApi:{},requestAuto:{type:Boolean,default:!0},dataCallback:{},useSpanMethod:{type:Boolean,default:!1},useSpanMethodType:{default:""},title:{},pagination:{type:Boolean,default:!0},initParam:{default:{}},border:{type:Boolean,default:!1},toolButton:{type:Boolean,default:!0},rowKey:{default:"id"},searchCol:{default:()=>({xs:1,sm:2,md:2,lg:3,xl:4})},size:{},width:{},height:{},maxHeight:{},fit:{type:Boolean},stripe:{type:Boolean},context:{},showHeader:{type:Boolean},showSummary:{type:Boolean},sumText:{},summaryMethod:{},rowClassName:{},rowStyle:{},cellClassName:{},cellStyle:{},headerRowClassName:{},headerRowStyle:{},headerCellClassName:{},headerCellStyle:{},highlightCurrentRow:{type:Boolean},currentRowKey:{},emptyText:{},expandRowKeys:{},defaultExpandAll:{type:Boolean},defaultSort:{},tooltipEffect:{},tooltipOptions:{},spanMethod:{},selectOnIndeterminate:{type:Boolean},indent:{},treeProps:{},lazy:{type:Boolean},load:{},className:{},style:{},tableLayout:{},scrollbarAlwaysOn:{type:Boolean},flexible:{type:Boolean}},setup(f,{expose:p}){const l=f,m=S(!0),t=S(),{selectionChange:i,selectedList:a,selectedListIds:r,isSelected:e}=Ee(l.rowKey),{tableData:o,pageable:s,searchParam:d,searchInitParam:u,getTableList:c,search:_,reset:T,handleSizeChange:A,handleCurrentChange:$}=Be(l.requestApi,l.initParam,l.pagination,l.dataCallback),k=()=>t.value.clearSelection();ue(()=>l.requestAuto&&c()),Y(()=>l.initParam,c,{deep:!0});const L=S(l.columns),E=S(new Map);q("enumMap",E);const Z=async n=>{if(!n.enum)return;if(typeof n.enum!="function")return E.value.set(n.prop,n.enum);const{data:y}=await n.enum();E.value.set(n.prop,y)},W=(n,y=[])=>(n.forEach(async v=>{var P;(P=v._children)!=null&&P.length&&y.push(...W(v._children)),y.push(v),v.isShow=v.isShow??!0,v.isFilterEnum=v.isFilterEnum??!0,Z(v)}),y.filter(v=>{var P;return!((P=v._children)!=null&&P.length)})),K=S();K.value=W(L.value);const D=K.value.filter(n=>{var y;return(y=n.search)==null?void 0:y.el});D.forEach((n,y)=>{var v,P,h,M;n.search.order=n.search.order??y+2,((v=n.search)==null?void 0:v.defaultValue)!==void 0&&((P=n.search)==null?void 0:P.defaultValue)!==null&&(u.value[n.search.key??U(n.prop)]=(h=n.search)==null?void 0:h.defaultValue,d.value[n.search.key??U(n.prop)]=(M=n.search)==null?void 0:M.defaultValue)}),D.sort((n,y)=>n.search.order-y.search.order);const X=S(),Q=L.value.filter(n=>!["selection","index","expand","none"].includes(n.type)&&n.prop!=="operation"),ge=I(()=>l.useSpanMethod?_e:null),ve=(n,y)=>{let v=[],P=0;for(let h=0;h<n.length;h++)h===0?(v.push(1),P=0):n[h][y]===n[h-1][y]?(v[P]+=1,v.push(0)):(v.push(1),P=h);return v},_e=({column:n,rowIndex:y,columnIndex:v})=>{let P=o.value;if(l.useSpanMethodType==="offline"&&(v===0||v===31)){const M=ve(P,n.property)[y],ee=M>0?1:0;return{rowspan:M,colspan:ee}}};return p({element:t,tableData:o,searchParam:d,pageable:s,getTableList:c,reset:T,clearSelection:k,enumMap:E,isSelected:e,selectedList:a,selectedListIds:r}),(n,y)=>{const v=B("el-divider"),P=B("el-table-column");return g(),x(O,null,[N("div",ea,[N("div",aa,[R(n.$slots,"title",{},void 0,!0)]),de(C(Fe,{search:b(_),reset:b(T),searchParam:b(d),columns:b(D),searchCol:n.searchCol},null,8,["search","reset","searchParam","columns","searchCol"]),[[ie,m.value]]),b(D).length?(g(),V(v,{key:0})):j("",!0),N("div",la,[ta,N("div",oa,[R(n.$slots,"tableHeader",{selectedListIds:b(r),selectedList:b(a),isSelected:b(e)},void 0,!0)])]),C(b(Ie),H({ref_key:"tableRef",ref:t},n.$attrs,{data:b(o),border:n.border,"span-method":ge.value,"row-key":n.rowKey,onSelectionChange:b(i)}),{append:w(()=>[R(n.$slots,"append",{},void 0,!0)]),empty:w(()=>[N("div",ra,[R(n.$slots,"empty",{},()=>[na,sa],!0)])]),default:w(()=>[R(n.$slots,"default",{},void 0,!0),(g(!0),x(O,null,J(L.value,h=>(g(),x(O,{key:h},[h.type=="selection"||h.type=="index"?(g(),V(P,H({key:0},h,{align:h.align??"center","reserve-selection":h.type=="selection"}),null,16,["align","reserve-selection"])):j("",!0),h.type=="expand"?(g(),V(P,H({key:1},h,{align:h.align??"center"}),{default:w(M=>[h.render?(g(),V(G(h.render),{key:0,row:M.row},null,8,["row"])):R(n.$slots,h.type,{key:1,row:M.row},void 0,!0)]),_:2},1040,["align"])):j("",!0),!h.type&&h.prop&&h.isShow?(g(),V(Qe,{key:2,column:h},se({_:2},[J(Object.keys(n.$slots),M=>({name:M,fn:w(ee=>[R(n.$slots,M,{row:ee.row},void 0,!0)])}))]),1032,["column"])):j("",!0)],64))),128))]),_:3},16,["data","border","span-method","row-key","onSelectionChange"]),R(n.$slots,"pagination",{},()=>[n.pagination?(g(),V(He,{key:0,pageable:b(s),handleSizeChange:b(A),handleCurrentChange:b($)},null,8,["pageable","handleSizeChange","handleCurrentChange"])):j("",!0)],!0)]),n.toolButton?(g(),V(Xe,{key:0,ref_key:"colRef",ref:X,colSetting:b(Q),"onUpdate:colSetting":y[0]||(y[0]=h=>Ne(Q)?Q.value=h:null)},null,8,["colSetting"])):j("",!0)],64)}}});const ia=le(pa,[["__scopeId","data-v-5390eecb"]]);export{ia as P};
